<?xml version="1.0"?>
<page path="quickstart" short-title="Quickstart">

    <div class="row">
        <div class="col-lg-12">
            <h1><a id="getting-started"></a>Quickstart
            </h1>
            <p>Server Mechanic is about changing a server or virtual machine by applying a migration script once and
                only once. So you can checkin setup and adjustments to your infrastructure as scripts into your
                preferred source code management system.
            </p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <h2>How it works</h2>
            <p>With Server Mechanic you author changes to your machines as scripts in your favorite language, e.g. shell
                scripts. Server Mechanic collects these migration scripts, executes them and records them as applied in
                an internal database. Next time only new migrations will be executed. In case of an error you fix the
                problem and start over.
            </p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <h2>The Server Mechanic playground</h2>
            <p>The Server Mechanic playground (mechanic-playground) is a docker container with a mechanic preinstalled so
                you instantly can start playing with mechnic.
            </p>

            <h4>Pull from dockerhub</h4>
            <code><![CDATA[
docker pull servermechanic/mechanic-playground
]]></code>

            <h4>Create a playground</h4>
            <code><![CDATA[# create folder to mount as mechanic volume
mkdir srv-mechanic-volume

# create folder mechanic will pickup migrations from
mkdir srv-mechanic-volume/migration.d/

# start the container
docker run -d --name my-mechanic-playground \
    -v $PWD/srv-mechanic-volume:/srv/mechanic \
    mechanic-playground
]]></code>

            <p>List migrations already applied</p>
            <code><![CDATA[
docker exec -t my-mechanic-playground mechanic list-migrations
]]></code>
            <p>This should list an initial migration applied on startup. One migration is part of the container and is
                applied on first startup.
            </p>

            <h2>Add own migration</h2>
            <p>A migration can be written as a shell script. This is a simple example migration:</p>
            <code><![CDATA[
#!/bin/bash -ex

echo "# config for hooray" > /srv/mechanic/hooray.conf
exit 0
]]></code>

            <p>The next command places the migration script in the mechanic migrations folder and makes it executable.
            </p>

            <code><![CDATA[
cat - > srv-mechanic-volume/migration.d/20161224_hooray.sh <<EOB
#!/bin/bash -ex

echo "# config for hooray" > /srv/mechanic/hooray.conf
exit 0
EOB
chmod 755 srv-mechanic-volume/migration.d/20161224_hooray.sh
]]></code>

            <p>Run the Server Mechanic to apply migrations</p>
            <code><![CDATA[
docker exec -t my-mechanic-playground mechanic -v migrate
]]></code>

            <p>Query Server Mechanic if the migration has been applied</p>
            <code><![CDATA[
docker exec -t my-mechanic-playground mechanic list-migrations
]]></code>

            <p>Verify that the migration's effect is visible:</p>
            <code><![CDATA[
cat srv-mechanic-volume/hooray.conf
]]></code>
        </div>
    </div>
</page>
